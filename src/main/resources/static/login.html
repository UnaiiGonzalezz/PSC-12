<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Iniciar sesión</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<nav>
  <a href="index.html">Catálogo</a>
  <a href="cliente.html">Clientes</a>
  <a href="compra.html">Ver compra</a>
  <a href="nueva-compra.html">Nueva compra</a>
  <a href="admin.html">Admin</a>
</nav>

<!-- NO mostramos el botón logout aquí -->

<h1>Inicio de sesión</h1>

<form onsubmit="login(); return false;">
  <label>Email:</label>
  <input type="email" id="email" required><br>

  <label>Contraseña:</label>
  <input type="password" id="password" required><br>

  <button type="submit">Entrar</button>
</form>

<p id="mensaje"></p>

<script>
function login() {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();

  fetch('/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  })
  .then(r => {
    if (!r.ok) throw new Error('Login incorrecto');
    return r.json();
  })
  .then(data => {
    const token = data.token;
    const rol = data.rol;
    alert('Login correcto como ' + rol);

    sessionStorage.setItem('token', token);
    sessionStorage.setItem('rol', rol);

    window.location.href = 'index.html';
  })
  .catch(() => {
    document.getElementById('mensaje').textContent = 'Error al iniciar sesión.';
  });
}
</script>

</body>
</html>
