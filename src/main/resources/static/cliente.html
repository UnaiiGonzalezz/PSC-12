<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestionar Clientes</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<nav>
  <a href="index.html">Catálogo</a>

  <a href="compra.html">Ver compra</a>
  <a href="nueva-compra.html">Nueva compra</a>
  <a href="admin.html">Admin</a>
  <button id="logoutBtn" class="logout-button" onclick="logout()">Cerrar sesión</button>
</nav>

<h1>Clientes Registrados</h1>

<table id="tablaClientes">
  <thead>
    <tr><th>Nombre</th><th>Apellido</th><th>Email</th><th>Método de Pago</th><th>Rol</th></tr>
  </thead>
  <tbody id="tbody-clientes"></tbody>
</table>

<script>
const token = sessionStorage.getItem('token');
const rol = sessionStorage.getItem('rol');

window.onload = function() {
  if (!token || (rol !== 'ADMIN' && rol !== 'USER')) {
    alert('Acceso denegado.');
    window.location.href = 'login.html';
  }
  cargarClientes();
};

function logout() {
  sessionStorage.removeItem('token');
  sessionStorage.removeItem('rol');
  window.location.href = 'login.html';
}

function cargarClientes() {
  fetch('/api/cliente', {
    headers: { 'Authorization': 'Bearer ' + token }
  })
  .then(r => r.json())
  .then(clientes => {
    const tbody = document.getElementById('tbody-clientes');
    tbody.innerHTML = clientes.map(c => `
      <tr>
        <td>${c.nombre}</td>
        <td>${c.apellido}</td>
        <td>${c.email}</td>
        <td>${c.metodoPago}</td>
        <td>${c.rol}</td>
      </tr>
    `).join('');
  })
  .catch(() => alert('Error cargando clientes.'));
}
</script>

</body>
</html>
