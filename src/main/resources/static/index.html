<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Farmacia - Catálogo</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>

  <nav>
    <a href="cliente.html">Clientes</a> |
    <a href="compra.html">Ver compra</a> |
  </nav>

  <h1>Medicamentos disponibles</h1>

  <div class="toolbar">
    <input id="buscador" placeholder="Buscar por nombre…" />
    <button onclick="cargar()">Buscar</button>
  </div>

  <table>
    <thead>
      <tr><th>Nombre</th><th>Precio&nbsp;(€)</th><th></th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="paginacion">
    <button onclick="prev()" id="prev">&larr; Anterior</button>
    <span id="pagina"></span>
    <button onclick="next()" id="next">Siguiente &rarr;</button>
  </div>

<script>
let page = 0, size = 10;

function pintar(meds, totalPages) {
  const tbody = document.getElementById('tbody');
  tbody.innerHTML = meds.map(m =>
    `<tr>
       <td>${m.nombre}</td>
       <td>€${m.precio.toFixed(2)}</td>
       <td><a href="medicamento.html?id=${m.id}">Ver</a></td>
     </tr>`).join('');

  /* paginación */
  document.getElementById('pagina').textContent = `Página ${page + 1} de ${totalPages}`;
  document.getElementById('prev').disabled = page === 0;
  document.getElementById('next').disabled = page + 1 >= totalPages;
}

function cargar() {
  const q = document.getElementById('buscador').value.trim();
  let url;

  if (q) {                       // búsqueda directa
    url = `/medicamentos/nombre/${encodeURIComponent(q)}`;
    fetch(url).then(r => r.json()).then(list => pintar(list, 1));
  } else {                       // paginado
    url = `/medicamentos/pag?page=${page}&size=${size}&sort=nombre,asc`;
    fetch(url).then(r => r.json()).then(data => pintar(data.content, data.totalPages));
  }
}

function next() { page++; cargar(); }
function prev() { page--; cargar(); }

window.onload = cargar;
</script>
</body>
</html>
